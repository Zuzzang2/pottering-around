<!DOCTYPE html>
<html lang="ko">
    <head>
        <meta charset="UTF-8" />
        <title>통합 실습: 포켓몬 검색기</title>
        <style>
            body {
                font-family: sans-serif;
            }
            .container {
                max-width: 500px;
                margin: 40px auto;
                padding: 20px;
                border: 1px solid lightgray;
                border-radius: 8px;
                text-align: center;
            }
            input {
                padding: 10px;
                width: 60%;
                margin-right: 10px;
            }
            button {
                padding: 10px;
            }
            #result {
                margin-top: 20px;
            }
            #result h2 {
                margin: 10px 0;
            }
            #result img {
                width: 150px;
                height: 150px;
                background-color: ghostwhite;
                border-radius: 50%;
            }
            .type {
                display: inline-block;
                padding: 5px 10px;
                margin: 5px;
                border-radius: 15px;
                color: white;
            }
        </style>
    </head>
    <body>
        <div class="container">
            <h1>포켓몬 정보 조회</h1>
            <input
                type="text"
                id="pokemon-input"
                placeholder="포켓몬 이름 또는 번호 입력"
            />
            <button id="search-btn">정보 조회</button>
            <div id="result"></div>
        </div>

        <script>
            const searchBtn = document.getElementById("search-btn");
            const pokemonInput = document.getElementById("pokemon-input");
            const resultDiv = document.getElementById("result");

            // 버튼 클릭 시 async 함수 실행
            searchBtn.addEventListener("click", async () => {
                // 1. 사용자 입력값 가져오기 (소문자로 변환)
                const pokemonNameOrId = pokemonInput.value.toLowerCase();
                if (!pokemonNameOrId) {
                    alert("포켓몬 이름 또는 번호를 입력해주세요!");
                    return;
                }

                // 2. API URL 조합
                const apiUrl = `https://pokeapi.co/api/v2/pokemon/${pokemonNameOrId}`;

                try {
                    // 로딩 메시지 표시
                    resultDiv.innerHTML = "<p>데이터를 불러오는 중...</p>";

                    // 3. await: fetch 요청이 끝날 때까지 기다림
                    const response = await fetch(apiUrl);

                    // 4. 응답 상태 체크 (포켓몬을 찾지 못한 경우 등)
                    if (!response.ok) {
                        throw new Error("해당 포켓몬을 찾을 수 없습니다.");
                    }

                    // 5. await: JSON 파싱이 끝날 때까지 기다림
                    const pokemonData = await response.json();

                    // 6. 받아온 데이터로 화면 그리기
                    renderPokemon(pokemonData);
                } catch (error) {
                    // 7. try 블록 내에서 발생한 모든 에러(네트워크, 파싱 등)를 여기서 처리
                    console.error("에러 발생:", error);
                    resultDiv.innerHTML = `<p style="color: red;">${error.message}</p>`;
                }
            });

            // 포켓몬 데이터를 받아 HTML로 변환하여 화면에 출력하는 함수
            function renderPokemon(data) {
                // 타입 정보를 HTML 문자열로 변환 (예: ['grass', 'poison'] -> '<span class="type">grass</span>...')
                const typesHtml = data.types
                    .map((typeInfo) => {
                        return `<span class="type" style="background-color: ${getTypeColor(
                            typeInfo.type.name
                        )}">${typeInfo.type.name}</span>`;
                    })
                    .join(" ");

                resultDiv.innerHTML = `
                <h2>${
                    data.name.charAt(0).toUpperCase() + data.name.slice(1)
                } (#${data.id})</h2>
                <img src="${data.sprites.front_default}" alt="${data.name}">
                <div>
                    <h3>타입</h3>
                    ${typesHtml}
                </div>
            `;
            }

            // 포켓몬 타입에 따라 다른 배경색을 반환하는 헬퍼 함수
            function getTypeColor(type) {
                const colors = {
                    fire: "orangered",
                    water: "dodgerblue",
                    grass: "limegreen",
                    bug: "darkkhaki",
                    normal: "lightgray",
                    poison: "mediumpurple",
                    electric: "gold",
                    ground: "sandybrown",
                    fairy: "lightpink",
                    fighting: "indianred",
                    psychic: "hotpink",
                    rock: "darkgoldenrod",
                    ghost: "rebeccapurple",
                    ice: "lightcyan",
                    dragon: "slateblue",
                };
                return colors[type] || "gray";
            }
        </script>
    </body>
</html>
